<div class="job-form-container">
  <h2>{{ isEditMode ? 'Edit Job Application' : 'New Job Application' }}</h2>

  <form (ngSubmit)="submitForm()">
    <input type="hidden" [(ngModel)]="job.user_id" name="user_id">

    <div class="form-group">
      <label>Job Title *</label>
      <input type="text" [(ngModel)]="job.job_title" name="job_title" required>
    </div>

    <div class="form-group">
      <label>Company *</label>
      <input type="text" [(ngModel)]="job.company" name="company" required>
    </div>

    <div class="form-group">
      <label>Role Category</label>
      <select [(ngModel)]="job.role_category" name="role_category">
        <option value="">Select Category</option>
        <option *ngFor="let role of roles" [value]="role.name">
          {{ role.name }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label>Status *</label>
      <select [(ngModel)]="job.status" name="status" required>
        <option *ngFor="let status of statuses" [value]="status">
          {{ status | titlecase }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label>Applied Date</label>
      <input type="date" [(ngModel)]="job.applied_date" name="applied_date">
    </div>

    <!-- General Notes (always available) -->
    <div class="form-group">
      <label>
        {{ job.status === 'offer' || job.status === 'accepted' || job.status === 'rejected' ? 'General Notes' : 'Notes' }}
      </label>
      <textarea [(ngModel)]="job.general_notes" name="general_notes" rows="3"
                placeholder="Leave blank if no notes yet"></textarea>
    </div>

    <!-- Basic Feedback Input (short summary) -->
    <div class="form-group">
      <label>Feedback Summary (Max 50 characters)</label>
      <input type="text" 
             [(ngModel)]="job.feedbackSummary" 
             name="feedbackSummary"
             maxlength="50"
             placeholder="Brief summary">
    </div>

    <!-- Detailed Feedback Section -->
    <div *ngIf="job.status === 'rejected' || job.status === 'accepted' || job.status === 'offer'" class="feedback-section">
      <h3>Detailed Feedback</h3>
      
      <div class="form-group" *ngIf="feedbackCategories.length > 0">
        <label>Feedback Category</label>
        <select [(ngModel)]="job.feedback.category_id" name="feedback.category_id">
          <option [ngValue]="null">Select Category</option>
          <option *ngFor="let cat of feedbackCategories" [value]="cat.id">
            {{ cat.name }} ({{ cat.type }})
          </option>
        </select>
      </div>
    
      <div class="form-group">
        <label>Detailed Feedback Notes</label>
        <textarea [(ngModel)]="job.feedback.detailed_feedback" 
                  name="detailed_feedback"
                  rows="3"
                  placeholder="Detailed notes"></textarea>
      </div>
    
      <!-- Key Improvements (Only for Rejected) -->
      <div class="form-group" *ngIf="job.status === 'rejected'">
        <label>Key Improvements</label>
        <textarea [(ngModel)]="job.feedback.key_improvements" name="key_improvements" rows="3"></textarea>
      </div>

      <!-- Key Strengths (Only for Accepted/Offer) -->
        <div class="form-group" *ngIf="job.status === 'accepted' || job.status === 'offer'">
        <label>Key Strengths</label>
        <textarea [(ngModel)]="job.feedback.key_strengths" name="key_strengths" rows="3"></textarea>
        </div>

    </div>

    <div class="form-actions">
      <button type="submit" class="primary-button">
        {{ isEditMode ? 'Update Application' : 'Create Application' }}
      </button>
      <button type="button" (click)="router.navigate(['/jobs'])" class="secondary-button">
        Cancel
      </button>
    </div>
  </form>

  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
</div>
